env:
  - name: DEPLOY_NAMESPACE
    value: jx-staging
pipelineConfig:
  env:
    - name: DEPLOY_NAMESPACE
      value: jx-staging
  pipelines:
    release:
      postBuild:
        steps:
          - loop:
              variable: DEPLOYMENT
              values:
                - ps-jx-overidden-pipeline
                - ps-jx-java-quickstart
              steps:
                - sh: kubectl get deployments
                - sh: kubectl get deployments --namespace=jx-staging
                - command: kubectl
                  name: Wait for service to start
                  args:
                    - rollout
                    - status
                    - deployment
                    - ${DEPLOYMENT}
                    - "--namespace=jx-staging"
          - name: Run acceptance tests
            command: mvn
            args:
              - "-f"
              - acceptance-tests
              - test
            image: "maven:latest"
